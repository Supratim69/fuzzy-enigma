// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "cockroachdb"
  url      = env("DATABASE_URL")
  relationMode = "prisma"
}

model User {
  id             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name           String
  email          String    @unique
  authProvider   String    @map("auth_provider")
  avatarUrl      String?   @map("avatar_url")
  dietPreference String?   @map("diet_preference")
  createdAt      DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt      DateTime  @updatedAt @map("updated_at") @db.Timestamptz

  favorites      Favorite[]

  @@index([email])
  @@index([authProvider])
  @@map("users")
}

model Favorite {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId      String    @map("user_id") @db.Uuid
  recipeId    String    @map("recipe_id")
  recipeName  String    @map("recipe_name")
  recipeImage String?   @map("recipe_image")
  cuisine     String?
  dateSaved   DateTime  @default(now()) @map("date_saved") @db.Timestamptz
  deletedAt   DateTime? @map("deleted_at") @db.Timestamptz

  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, recipeId, deletedAt])
  @@index([userId])
  @@index([recipeId])
  @@index([deletedAt])
  @@index([userId, deletedAt])
  @@map("favorites")
}